@if (workloadData) {
  <div>
    <div class="flex flex-col flex-auto w-full p-8 xs:p-2">
      <div class="flex flex-wrap w-full">

        <!-- Header -->
        <div class="flex items-center justify-between w-full my-4 px-4 xs:pr-0">
          <div class="mr-6">
            <h2 class="m-0">Workload Insights</h2>
            <div class="text-secondary tracking-tight">Drive activity rates, intensity, and endurance</div>
          </div>

          <!-- Duration selector -->
          <div class="flex items-center">
            <mat-button-toggle-group
              [value]="durationKey"
              (change)="changeDuration($event.value)"
              class="duration-toggle">
              <mat-button-toggle value="day">Day</mat-button-toggle>
              <mat-button-toggle value="week">Week</mat-button-toggle>
              <mat-button-toggle value="month">Month</mat-button-toggle>
              <mat-button-toggle value="year">Year</mat-button-toggle>
              <mat-button-toggle value="forever">All</mat-button-toggle>
            </mat-button-toggle-group>
          </div>
        </div>

        <!-- Spike alerts -->
        @if (spikeDevices.length > 0) {
          <div class="w-full px-4 mb-4">
            <div class="spike-alert p-4 rounded-lg">
              <div class="flex items-center mb-2">
                <mat-icon class="text-yellow-500 mr-2" svgIcon="warning"></mat-icon>
                <span class="font-semibold">Activity Spike Detected</span>
              </div>
              @for (device of spikeDevices; track device.device_wwn) {
                <div class="text-sm ml-8">
                  {{ device.device_wwn }} &mdash; {{ device.spike.description }}
                </div>
              }
            </div>
          </div>
        }

        <!-- Device table -->
        <div class="w-full px-4">
          <div class="mat-elevation-z2 rounded-lg overflow-hidden">
            <table mat-table [dataSource]="dataSource" matSort class="w-full">

              <!-- Device column -->
              <ng-container matColumnDef="device_wwn">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Device</th>
                <td mat-cell *matCellDef="let row" class="cursor-pointer" (click)="navigateToDevice(row.device_wwn)">
                  <span class="font-medium">{{ row.device_wwn }}</span>
                </td>
              </ng-container>

              <!-- Protocol column -->
              <ng-container matColumnDef="device_protocol">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Protocol</th>
                <td mat-cell *matCellDef="let row">{{ row.device_protocol }}</td>
              </ng-container>

              <!-- Daily Writes column -->
              <ng-container matColumnDef="daily_writes">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Daily Writes</th>
                <td mat-cell *matCellDef="let row">
                  @if (row.daily_write_bytes > 0) {
                    {{ row.daily_write_bytes | fileSize }}/day
                  } @else {
                    <span class="text-gray-400">-</span>
                  }
                </td>
              </ng-container>

              <!-- Daily Reads column -->
              <ng-container matColumnDef="daily_reads">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Daily Reads</th>
                <td mat-cell *matCellDef="let row">
                  @if (row.daily_read_bytes > 0) {
                    {{ row.daily_read_bytes | fileSize }}/day
                  } @else {
                    <span class="text-gray-400">-</span>
                  }
                </td>
              </ng-container>

              <!-- R/W Ratio column -->
              <ng-container matColumnDef="rw_ratio">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>R/W Ratio</th>
                <td mat-cell *matCellDef="let row">
                  <span [class.text-gray-400]="row.daily_write_bytes <= 0 && row.daily_read_bytes <= 0">
                    {{ formatRatio(row) }}
                  </span>
                </td>
              </ng-container>

              <!-- Intensity column -->
              <ng-container matColumnDef="intensity">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Intensity</th>
                <td mat-cell *matCellDef="let row">
                  <span class="font-semibold capitalize" [ngClass]="intensityColor(row.intensity)">
                    {{ row.intensity }}
                  </span>
                </td>
              </ng-container>

              <!-- Endurance column -->
              <ng-container matColumnDef="endurance">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Endurance</th>
                <td mat-cell *matCellDef="let row">
                  @if (row.endurance?.available) {
                    <div class="flex items-center">
                      <mat-progress-bar
                        class="endurance-bar mr-2"
                        mode="determinate"
                        [color]="enduranceColor(row.endurance.percentage_used)"
                        [value]="row.endurance.percentage_used">
                      </mat-progress-bar>
                      <span class="text-sm whitespace-nowrap">{{ row.endurance.percentage_used }}%</span>
                    </div>
                  } @else {
                    <span class="text-gray-400">N/A</span>
                  }
                </td>
              </ng-container>

              <!-- Estimated Remaining column -->
              <ng-container matColumnDef="est_remaining">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Est. Remaining</th>
                <td mat-cell *matCellDef="let row">
                  @if (row.endurance?.available && row.endurance?.estimated_lifespan_days > 0) {
                    {{ formatDays(row.endurance.estimated_lifespan_days) }}
                  } @else {
                    <span class="text-gray-400">-</span>
                  }
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700" (click)="navigateToDevice(row.device_wwn)"></tr>
            </table>
          </div>
        </div>

      </div>
    </div>
  </div>
} @else {
  <div class="dashboard-placeholder content-layout fullwidth-basic-content-scroll">
    <img
      class="image"
      src="/assets/images/dashboard-placeholder.png">

    <h1>No Workload Data Available</h1>

    <p style="max-width:700px;">
      Workload insights are computed from SMART attribute history.
      Once your collector has submitted at least two SMART data points for a device,
      workload rates and intensity will appear here.
    </p>
  </div>
}
