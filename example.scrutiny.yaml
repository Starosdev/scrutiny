# Commented Scrutiny Configuration File
#
# The default location for this file is /opt/scrutiny/config/scrutiny.yaml.
# In some cases to improve clarity default values are specified,
# uncommented. Other example values are commented out.
#
# When this file is parsed by Scrutiny, all configuration file keys are
# lowercased automatically. As such, Configuration keys are case-insensitive,
# and should be lowercase in this file to be consistent with usage.
#
######################################################################
# Environment Variable Overrides
#
# Any configuration key can be overridden via environment variables using
# the SCRUTINY_ prefix. Dots and dashes in key names become underscores.
#
# Pattern: SCRUTINY_<KEY_WITH_DOTS_AS_UNDERSCORES>
#
# Examples:
#   web.listen.port                       -> SCRUTINY_WEB_LISTEN_PORT
#   web.listen.host                       -> SCRUTINY_WEB_LISTEN_HOST
#   web.listen.basepath                   -> SCRUTINY_WEB_LISTEN_BASEPATH
#   web.database.location                 -> SCRUTINY_WEB_DATABASE_LOCATION
#   web.database.journal_mode             -> SCRUTINY_WEB_DATABASE_JOURNAL_MODE
#   web.src.frontend.path                 -> SCRUTINY_WEB_SRC_FRONTEND_PATH
#   web.influxdb.scheme                   -> SCRUTINY_WEB_INFLUXDB_SCHEME
#   web.influxdb.host                     -> SCRUTINY_WEB_INFLUXDB_HOST
#   web.influxdb.port                     -> SCRUTINY_WEB_INFLUXDB_PORT
#   web.influxdb.org                      -> SCRUTINY_WEB_INFLUXDB_ORG
#   web.influxdb.bucket                   -> SCRUTINY_WEB_INFLUXDB_BUCKET
#   web.influxdb.token                    -> SCRUTINY_WEB_INFLUXDB_TOKEN
#   web.influxdb.init_username            -> SCRUTINY_WEB_INFLUXDB_INIT_USERNAME
#   web.influxdb.init_password            -> SCRUTINY_WEB_INFLUXDB_INIT_PASSWORD
#   web.influxdb.tls.insecure_skip_verify -> SCRUTINY_WEB_INFLUXDB_TLS_INSECURE_SKIP_VERIFY
#   web.influxdb.retention_policy         -> SCRUTINY_WEB_INFLUXDB_RETENTION_POLICY
#   web.metrics.enabled                   -> SCRUTINY_WEB_METRICS_ENABLED
#   log.level                             -> SCRUTINY_LOG_LEVEL
#   log.file                              -> SCRUTINY_LOG_FILE
#   notify.urls                           -> SCRUTINY_NOTIFY_URLS (comma-separated)
#
# Environment variables take precedence over config file values.
######################################################################


######################################################################
# Version
#
# version specifies the version of this configuration file schema, not
# the scrutiny binary. There is only 1 version available at the moment
version: 1

web:
  listen:
    port: 8080
    host: 0.0.0.0

    # if you're using a reverse proxy like apache/nginx, you can override this value to serve scrutiny on a subpath.
    # eg. http://example.com/scrutiny/* vs http://example.com:8080
    # see docs/TROUBLESHOOTING_REVERSE_PROXY.md
    # basepath: `/scrutiny`
    # leave empty unless behind a path prefixed proxy
    basepath: ''
  database:
    # can also set absolute path here
    location: /opt/scrutiny/config/scrutiny.db
    # SQLite journal mode: WAL (default), DELETE, TRUNCATE, PERSIST, MEMORY, OFF
    # WAL mode is recommended for Docker containers with restricted capabilities (cap_drop: [ALL])
    # If you experience database issues with WAL mode on network filesystems (NFS), try DELETE mode
    # journal_mode: WAL
  src:
    # the location on the filesystem where scrutiny javascript + css is located
    frontend:
      path: /opt/scrutiny/web

  # if you're running influxdb on a different host (or using a cloud-provider) you'll need to update the host & port below.
  # token, org, bucket are unnecessary for a new InfluxDB installation, as Scrutiny will automatically run the InfluxDB setup,
  # and store the information in the config file. If you 're re-using an existing influxdb installation, you'll need to provide
  # the `token`
  influxdb:
#    scheme: 'http'
    host: 0.0.0.0
    port: 8086
#    token: 'my-token'
#    org: 'my-org'
#    bucket: 'bucket'
    retention_policy: true
    # Retention periods for InfluxDB buckets (in seconds)
    # These control how long metrics data is kept in each downsampling bucket
    # See docs/DOWNSAMPLING.md for details on the bucket structure
    #
    # retention:
    #   daily: 1296000    # 15 days (default) - raw metrics bucket
    #   weekly: 5443200   # 9 weeks (default) - weekly aggregated data
    #   monthly: 65318400 # 25 months (default) - monthly aggregated data
    #   # yearly bucket has infinite retention (not configurable)

  # Prometheus metrics endpoint configuration
  metrics:
    # Enable or disable Prometheus metrics endpoint (/api/metrics)
    enabled: true
    # if you wish to disable TLS certificate verification,
    # when using self-signed certificates for example,
    # then uncomment the lines below and set `insecure_skip_verify: true`
    # tls:
    #   insecure_skip_verify: false

log:
  file: '' #absolute or relative paths allowed, eg. web.log
  level: INFO

failures:
  # Transient attributes are ones that may temporarily show failures but recover
  # These are still evaluated but don't immediately trigger device failure status
  transient:
    ata:
      - 195 # Hardware_ECC_Recovered, see https://superuser.com/a/1511916/169872

  # Ignored attributes are completely excluded from failure evaluation
  # Use this for attributes that report invalid/corrupted data on your drives
  # See issue #84: some drives report impossibly high values for certain devstat attributes
  ignored:
    ata: []       # numeric SMART attribute IDs, e.g., [1, 9, 199]
    devstat: []   # string-based device statistics, e.g., ["devstat_1_40", "devstat_1_48"]
    nvme: []      # NVME attribute IDs, e.g., ["media_errors"]
    scsi: []      # SCSI attribute IDs, e.g., ["scsi_grown_defect_list"]

######################################################################
# SMART Attribute Overrides
#
# Customize how individual SMART attributes are evaluated.
# Use this to suppress false positives, force specific statuses,
# or set custom warning/failure thresholds.
#
# Each override requires:
#   - protocol: ATA, NVMe, or SCSI
#   - attribute_id: The attribute ID as a string (e.g., "5", "media_errors", "devstat_7_8")
#
# Optional fields:
#   - wwn: Limit the override to a specific device (by WWN)
#   - action: "ignore" (skip attribute) or "force_status" (set specific status)
#   - status: For force_status action: "passed", "warn", or "failed"
#   - warn_above: Custom threshold - warn when raw value exceeds this
#   - fail_above: Custom threshold - fail when raw value exceeds this (takes precedence)
#
#smart:
#  attribute_overrides:
#    # Example 1: Ignore a specific attribute that causes false positives
#    - protocol: ATA
#      attribute_id: "187"        # Reported_Uncorrect - often false positive on some drives
#      action: ignore
#
#    # Example 2: Ignore attribute only for a specific device
#    - protocol: ATA
#      attribute_id: "197"        # Current_Pending_Sector
#      wwn: "0x5000cca264eb01d7"  # Only apply to this drive
#      action: ignore
#
#    # Example 3: Force an attribute status to passed (suppress alerts)
#    - protocol: NVMe
#      attribute_id: "media_errors"
#      action: force_status
#      status: passed
#
#    # Example 4: Set custom thresholds for Reallocated Sectors Count
#    - protocol: ATA
#      attribute_id: "5"
#      warn_above: 5              # Warn when raw value > 5
#      fail_above: 10             # Fail when raw value > 10
#
#    # Example 5: Device statistics override
#    - protocol: ATA
#      attribute_id: "devstat_7_8"  # Percentage Used Endurance Indicator
#      warn_above: 80
#      fail_above: 95

# Notification "urls" look like the following. For more information about service specific configuration see
# Shoutrrr's documentation: https://containrrr.dev/shoutrrr/services/overview/
#
# note, usernames and passwords containing special characters will need to be urlencoded.
# if your username is: "myname@example.com" and your password is "124@34$1"
# your shoutrrr url will look like: "smtp://myname%40example%2Ecom:124%4034%241@ms.my.domain.com:587"

#notify:
#  urls:
#    - "discord://token@webhookid"
#    - "telegram://token@telegram?channels=channel-1[,channel-2,...]"
#    # For topic-based groups, append thread ID with colon: channels=chat_id:thread_id
#    # Example: telegram://token@telegram?channels=-123456789:12345
#    - "pushover://shoutrrr:apiToken@userKey/?priority=1&devices=device1[,device2, ...]"
#    - "slack://[botname@]token-a/token-b/token-c"
#    - "smtp://username:password@host:port/?fromAddress=fromAddress&toAddresses=recipient1[,recipient2,...]"
#    - "teams://token-a/token-b/token-c"
#    - "gotify://gotify-host/token"
#    - "pushbullet://api-token[/device/#channel/email]"
#    - "ifttt://key/?events=event1[,event2,...]&value1=value1&value2=value2&value3=value3"
#    - "mattermost://[username@]mattermost-host/token[/channel]"
#    - "ntfy://username:password@host:port/topic"
#    - "hangouts://chat.googleapis.com/v1/spaces/FOO/messages?key=bar&token=baz"
#    - "zulip://bot-mail:bot-key@zulip-domain/?stream=name-or-id&topic=name"
#    - "join://shoutrrr:api-key@join/?devices=device1[,device2, ...][&icon=icon][&title=title]"
#    - "script:///file/path/on/disk"
#    - "https://www.example.com/path"

######################################################################
# Collector Monitoring (Missed Ping Detection)
#
# Scrutiny can monitor for missed collector pings and send notifications
# when a collector has not sent data within the expected time window.
# This helps detect issues with collectors, networks, or cron jobs.
#
# These settings are configured via the Settings API, not this config file.
# Use the /api/settings endpoint to configure:
#
#   metrics.notify_on_missed_ping: false          # Enable/disable feature
#   metrics.missed_ping_timeout_minutes: 60       # Minutes before alerting
#   metrics.missed_ping_check_interval_mins: 5    # How often to check
#
# Example API call to enable missed ping notifications:
#   curl -X POST http://localhost:8080/api/settings \
#     -H "Content-Type: application/json" \
#     -d '{"metrics": {"notify_on_missed_ping": true, "missed_ping_timeout_minutes": 60}}'

########################################################################################################################
# FEATURES COMING SOON
#
# The following commented out sections are a preview of additional configuration options that will be available soon.
#
########################################################################################################################

#limits:
#  ata:
#    critical:
#      error: 10
#    standard:
#      error: 20
#      warn: 10
#  scsi:
#    critical: true
#    standard: true
#  nvme:
#    critical: true
#    standard: true

