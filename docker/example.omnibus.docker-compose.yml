version: '3.5'

services:
  scrutiny:
    restart: unless-stopped
    container_name: scrutiny
    image: ghcr.io/starosdev/scrutiny:latest-omnibus
    cap_add:
      - SYS_RAWIO
      - SYS_ADMIN  # Required for NVMe devices
    ports:
      - "8080:8080" # webapp
      - "8086:8086" # influxDB admin
    volumes:
      - /run/udev:/run/udev:ro
      - ./config:/opt/scrutiny/config
      - ./influxdb:/opt/scrutiny/influxdb
    # environment:
      # Enable ZFS pool monitoring (uncomment to enable)
      # See docs/ZFS_POOL_MONITORING.md for details
      # COLLECTOR_ZFS_CRON_SCHEDULE: "*/15 * * * *"
      # COLLECTOR_ZFS_RUN_STARTUP: "true"
    devices:
      - "/dev/sda"
      - "/dev/sdb"
      # NVMe: pass both controller (for SMART) and namespace (for performance benchmarks)
      # - "/dev/nvme0"
      # - "/dev/nvme0n1"
